{% extends 'base.html' %}

{% block title %}Offer Info - {{ offer.name }}{% endblock %}

{% block content %}
<!-- Load Animate.css for animations -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

<div class="container mx-auto p-4 sm:p-6 lg:p-8">
    <!-- Hero Section -->
    <div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white rounded-t-lg p-6 sm:p-8 animate__animated animate__fadeIn">
        <div class="flex flex-col sm:flex-row items-center gap-4">
            {% if offer.logo %}
                <img src="{{ offer.logo.url }}" alt="{{ offer.name }} Logo" class="w-16 h-16 sm:w-20 sm:h-20 object-contain rounded-full shadowPom shadow-lg">
            {% else %}
                <div class="w-16 h-16 sm:w-20 sm:h-20 bg-gray-200 flex items-center justify-center rounded-full shadow-lg">
                    <span class="text-gray-500">No Logo</span>
                </div>
            {% endif %}
            <div>
                <h1 class="text-2xl sm:text-3xl lg:text-4xl font-bold">{{ offer.name }}</h1>
                <p class="mt-2 text-sm sm:text-base">
                    Status: 
                    <span class="{% if offer.is_active == 'active' %}text-green-300{% else %}text-red-300{% endif %} font-semibold">
                        {{ offer.is_active|title }}
                    </span>
                </p>
            </div>
        </div>
    </div>

    <!-- Main Section -->
    <div class="bg-white rounded-b-lg shadow-lg p-6 sm:p-8">
        <div class="flex flex-col lg:flex-row gap-6">
            <!-- Images Section -->
            <div class="lg:w-1/3 flex flex-col items-center gap-4">
                <!-- Main Image -->
                <div class="w-full group">
                    <h2 class="text-lg font-semibold text-gray-700 mb-2">Offer Image</h2>
                    {% if offer.image %}
                        <img src="{{ offer.image.url }}" alt="{{ offer.name }}" class="w-48 h-48 sm:w-56 sm:h-56 object-contain mx-auto rounded-lg shadow-md transform group-hover:scale-105 transition duration-300">
                    {% else %}
                        <div class="w-48 h-48 sm:w-56 sm:h-56 bg-gray-200 flex items-center justify-center mx-auto rounded-lg shadow-md">
                            <span class="text-gray-500">No Image</span>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Details Section -->
            <div class="lg:w-2/3">
                <h2 class="text-xl sm:text-2xl font-semibold text-gray-800 mb-4 animate__animated animate__fadeInUp">Offer Details</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <p class="text-gray-600"><strong>Price:</strong> â‚¹{{ offer.price }}</p>
                        <p class="text-gray-600 mt-2"><strong>Theme:</strong> 
                            <span class="{% if offer.theme == 'blue' %}text-blue-500{% elif offer.theme == 'red' %}text-red-500{% elif offer.theme == 'green' %}text-green-500{% elif offer.theme == 'purple' %}text-purple-500{% endif %} font-semibold">
                                {{ offer.theme|title }}
                            </span>
                        </p>
                        <p class="text-gray-600 mt-2"><strong>Created:</strong> {{ offer.created_at|date:"F d, Y, H:i" }}</p>
                        <p class="text-gray-600 mt-2"><strong>Updated:</strong> {{ offer.updated_at|date:"F d, Y, H:i" }}</p>
                    </div>
                    <div>
                        <p class="text-gray-600"><strong>Description:</strong> {{ offer.description|default:"No description available." }}</p>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="mt-6 flex flex-col sm:flex-row sm:space-x-4 space-y-4 sm:space-y-0">
                    <a href="{% url 'offer_details' offer.id %}" class="inline-block bg-blue-500 text-white px-6 py-3 rounded-full hover:bg-blue-600 transition duration-300 animate__animated animate__pulse animate__infinite text-center">View Full Details</a>
                </div>
            </div>
        </div>

        <!-- Referral Section -->
        <div class="mt-8 bg-gradient-to-r from-blue-50 to-blue-100 p-6 rounded-lg shadow-md animate__animated animate__bounceIn">
            <h2 class="text-xl sm:text-2xl font-semibold text-gray-800 mb-4">Referral Benefits</h2>
            {% if referral %}
                <p class="text-green-600 mb-4">Referral ID: {{ referral.id }} (Status: {{ referral.working_state|title }})</p>
            {% else %}
                <p class="text-gray-600 mb-4">No referral yet.</p>
            {% endif %}
            {% if user.is_authenticated %}
                <!-- Social Sharing Buttons -->
                <div class="flex flex-wrap justify-center gap-3">
                    <!-- WhatsApp -->
                    <a href="https://api.whatsapp.com/send?text=Check out this amazing offer: http://127.0.0.1:8000/offer/{{ offer.id }}/details/?aff_sub1={{ referral.id }}" target="_blank" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition duration-300 flex items-center gap-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.732c-.291-.145-1.707-.837-1.972-.932-.265-.095-.458-.145-.652.145-.193.29-.752.932-.872.112-.12-.819-.48-1.638-1.086-2.03-.606-.39-1.013-.583-1.424-.678-.41-.095-.772-.12-1.062.315-.29.435-.677 1.013-.992 1.458-.315.445-.41.652-.772.508-.362-.145-1.523-.58-2.234-1.458-.71-.878-1.208-1.972-.677-2.407.53-.435 1.208-.208 1.523-.104.315.104.677.208 1.013.312.335.104.652.156.967-.052.315-.208.677-.932.772-1.248.095-.315.048-.652-.048-.967-.095-.315-.652-.677-1.208-.677-.556 0-1.013.208-1.523.677-.51.468-.967 1.248-.967 2.407 0 1.159.677 2.318 1.523 3.176.846.858 2.234 1.523 3.757 1.523 1.523 0 2.318-.677 2.873-1.523.556-.846.677-1.638.677-2.407 0-.769-.29-1.248-.677-1.638zm-5.472 8.268c-5.523 0-10-4.477-10-10s4.477-10 10 10-4.477 10-10 10zm0-18c-4.418 0-8 3.582-8 8s3.582 8 8 8 8-3.582 8-8-3.582-8-8-8z"/></svg>
                        Share on WhatsApp
                    </a>
                    <!-- Facebook -->
                    <a href="https://www.facebook.com/sharer/sharer.php?u=http://127.0.0.1:8000/offer/{{ offer.id }}/details/?aff_sub1={{ referral.id }}" target="_blank" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-300 flex items-center gap-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.987C18.343 21.128 22 16.991 22 12z"/></svg>
                        Share on Facebook
                    </a>
                    <!-- Twitter -->
                    <a href="https://twitter.com/intent/tweet?url=http://127.0.0.1:8000/offer/{{ offer.id }}/details/?aff_sub1={{ referral.id }}&text=Check out this amazing offer!" target="_blank" class="bg-blue-400 text-white px-4 py-2 rounded-lg hover:bg-blue-500 transition duration-300 flex items-center gap-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z"/></svg>
                        Share on Twitter
                    </a>
                    <!-- General Share Button (Web Share API) -->
                    <button onclick="shareOffer('http://127.0.0.1:8000/offer/{{ offer.id }}/details/?aff_sub1={{ referral.id }}', '{{ offer.name }}')" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition duration-300 flex items-center gap-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/></svg>
                        Share
                    </button>
                </div>
            {% else %}
                <!-- Prompt for Guest Users -->
                <p class="text-gray-600 mb-4">Want to earn rewards? Log in or register to start referring!</p>
                <div class="flex justify-center space-x-4">
                    <a href="{% url 'account_login' %}" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition duration-300">Login</a>
                    <a href="{% url 'account_signup' %}" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition duration-300">Register</a>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Back to Home -->
    <div class="mt-6 text-center animate__animated animate__fadeIn">
        <a href="{% url 'index' %}" class="text-blue-500 hover:underline text-lg">Back to Home</a>
    </div>
</div>

<!-- JavaScript for Web Share API -->
<script>
    function shareOffer(url, offerName) {
        if (navigator.share) {
            navigator.share({
                title: 'Check out this offer!',
                text: `Check out this amazing offer: ${offerName}`,
                url: url,
            })
            .then(() => console.log('Successful share'))
            .catch((error) => console.log('Error sharing', error));
        } else {
            alert('Web Share API is not supported in your browser. You can share using the social buttons above.');
        }
    }
</script>
{% endblock %}